<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	 <link href="style.css" rel="stylesheet">
	<script type="text/javascript">
	/*
		все переменные с _x , все id с __x
	*/
		function init(){
			if (localStorage.length <= 0){
				localStorage.setItem('maxKey','1');
			}
		}

		function showNotesList(){
			let _notesListDiv = document.createElement('div');
			_notesListDiv.id = "__forms__notesList";
			_notesListDiv.className = "notesList";
			//add div into DOM
			document.getElementById("__base-div__forms").appendChild(_notesListDiv);

			let _newUl = document.createElement('ul');
			_newUl.id = "__newUl";
			//add ul into div
			document.getElementById("__forms__notesList").appendChild(_newUl);
			//verify localstorage length
			let ul = document.getElementById("__newUl");
			for (let i = 1; i < localStorage.length; i++) {
				let _newLi = document.createElement('li');
				_newLi.innerHTML = 'i = '+i+' !';
				ul.appendChild(_newLi);
			}
			//add li into ul in loop


		}
		
		function newNote(){
			let _newTextArea = document.createElement('div');
  			_newTextArea.id = "__forms__textarea";
  			_newTextArea.className = "textarea_div";
  			_newTextArea.contentEditable = true;
  			_newTextArea.innerHTML = `Привет, мир! 
  			<br>  			
  			hohoho`;  			
			document.getElementById("__base-div__forms").appendChild(_newTextArea);
			let _newBtnSave = document.createElement('button');
			_newBtnSave.innerHTML = 'save';
			_newBtnSave.onclick = saveNote;
			document.getElementById("__base-div__forms").appendChild(_newBtnSave);			
		}

		function saveNote(){
			//alert(document.getElementById("__forms__textarea").innerHTML);
			/*
			if (localStorage.key('tags') == null) {
				alert('nulllll');
			}
			if (localStorage.length > 0) {
				alert(localStorage.key('tags'));
			}*/

			if (localStorage.length > 0) {
				let num = parseInt(localStorage.getItem('maxKey'),10);
				num++;
				localStorage.setItem('n_' + num,document.getElementById("__forms__textarea").innerHTML);
				localStorage.setItem('maxKey', num);	
			}			
		}

		function parseTags(){

		}





		/*
		let input = document.querySelector('.textarea_div');
			input.addEventListener('keyup', function (event) {
			    // забираем только текст, без тегов
			    var text = this.textContent;
			    // заменяем
			    var highlighted = text.replace(/(#\w+)/g, '<span class="hashtag">$1</span>');
			    // обновляем содержимое
			    this.innerHTML = highlighted;
			    // установка курсора в конец строки
			    placeCaretAtEnd(this);
			});		

		function placeCaretAtEnd(el) {
		    el.focus();
		    if (typeof window.getSelection != "undefined" &&
		        typeof document.createRange != "undefined"
		    ) {
		        var range = document.createRange();
		        range.selectNodeContents(el);
		        range.collapse(false);
		        var sel = window.getSelection();
		        sel.removeAllRanges();
		        sel.addRange(range);
		    } else if (typeof document.body.createTextRange != "undefined") {
		        var textRange = document.body.createTextRange();
		        textRange.moveToElementText(el);
		        textRange.collapse(false);
		        textRange.select();
		    }
		}*/


		init();
	</script>

	<title>Notes</title>
</head>
<body>
	<div class="base-div">
		<button onclick="newNote()">new note</button>
		<button onclick="showNotesList()">all notes</button>
		<button>etc</button>
		<div class="base-div__forms" id="__base-div__forms">
			
		</div>
		

	</div>

</body>
</html>