<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	 <link href="style.css" rel="stylesheet">
	<script type="text/javascript">
	/*
		все переменные с _x , все id с __x
	*/
		const _mask = 'n_';

		function init(){
			if (localStorage.length <= 0){
				localStorage.setItem('maxKey','1');
			}
		}
/*
		function del(){
			node = document.getElementById("div1");
	        var children = node.childNodes;
	        for(var i=0;i<children.length; i++) {
		        var child = children[i];          
		        node.removeChild(child);
      		}
      		document.write("<p> hello </p> ");
      		document.write("<button> get started </button>");
		}
*/
		function deleteNodes(){
			node = document.getElementById("__base-div__forms");
	        let children = node.childNodes;
	        if (children.length > 0){
	        	for(let i = 0; i < children.length; i++) {
		        	//let child = children[i];          
		        	node.removeChild(children[i]);
      			}	
	        }
		}

		function qq(k){
			alert(k);
		}



		function showNotesList(){
			//delete previous nodes in DOM
			deleteNodes();

			let _notesListDiv = document.createElement('div');
			_notesListDiv.id = "__forms__notesList";
			_notesListDiv.className = "notesList";
			//add div into DOM
			document.getElementById("__base-div__forms").appendChild(_notesListDiv);
			let _newUl = document.createElement('ul');
			_newUl.id = "__newUl";
			//add ul into div
			document.getElementById("__forms__notesList").appendChild(_newUl);
			let ul = document.getElementById("__newUl");
			//verify localstorage length
			if (localStorage.length > 0) {
				//add li into ul in loop
				for (let i = 0; i < localStorage.length; i++) {
					//mask verify
					let _key = localStorage.key(i);
					if (_key.indexOf(_mask) == 0) {
						let _newLi = document.createElement('li');
						_newLi.id = _key;
						_newLi.className = "noteListItem";
						_newLi.innerHTML = localStorage.getItem(_key);						
						_newLi.addEventListener('click', function(){note(_key);});
						ul.appendChild(_newLi);	
					}					
				}	
			}
		}
		
		function note(flg){
			/*
			flags: 
			1- new note
			2 - show note
			*/
			//delete previous childs DOM 
			deleteNodes();
			let _newTextArea = document.createElement('div');
  			_newTextArea.id = "__forms__textarea";
  			_newTextArea.className = "textarea_div";
  			_newTextArea.contentEditable = false;
  			//_newTextArea.innerHTML = ` `;  
  			//_newTextArea.readonly = true;
  			_newTextArea.setAttribute("placeHolder","enter note text");	
  			//_newTextArea.innerHTML = `sadasdasd `;	
			document.getElementById("__base-div__forms").appendChild(_newTextArea);
			//breakpoint: flg view|new note
			if (flg == undefined){ //new note
				_newTextArea.contentEditable = true;
				let _newBtnSave = document.createElement('button');
				_newBtnSave.innerHTML = 'save';
				_newBtnSave.onclick = saveNote;
				document.getElementById("__base-div__forms").appendChild(_newBtnSave);		

				let _newBtnSave1 = document.createElement('button');
				_newBtnSave1.innerHTML = 'save1';
				_newBtnSave1.onclick = te;
				document.getElementById("__base-div__forms").appendChild(_newBtnSave1);	
			} else { //view note
				_newTextArea.innerHTML = localStorage.getItem(flg);
			}
			
		}

		function te(){
			document.getElementById("__forms__textarea").contentEditable = true;
		}

		function saveNote(){
			//alert(document.getElementById("__forms__textarea").innerHTML);
			/*
			if (localStorage.key('tags') == null) {
				alert('nulllll');
			}
			if (localStorage.length > 0) {
				alert(localStorage.key('tags'));
			}*/

			
				let num = parseInt(localStorage.getItem('maxKey'),10);
				num++;
				localStorage.setItem(_mask + num,document.getElementById("__forms__textarea").innerHTML);
				localStorage.setItem('maxKey', num);	
				
		}

		function parseTags(){

		}





		/*
		let input = document.querySelector('.textarea_div');
			input.addEventListener('keyup', function (event) {
			    // забираем только текст, без тегов
			    var text = this.textContent;
			    // заменяем
			    var highlighted = text.replace(/(#\w+)/g, '<span class="hashtag">$1</span>');
			    // обновляем содержимое
			    this.innerHTML = highlighted;
			    // установка курсора в конец строки
			    placeCaretAtEnd(this);
			});		

		function placeCaretAtEnd(el) {
		    el.focus();
		    if (typeof window.getSelection != "undefined" &&
		        typeof document.createRange != "undefined"
		    ) {
		        var range = document.createRange();
		        range.selectNodeContents(el);
		        range.collapse(false);
		        var sel = window.getSelection();
		        sel.removeAllRanges();
		        sel.addRange(range);
		    } else if (typeof document.body.createTextRange != "undefined") {
		        var textRange = document.body.createTextRange();
		        textRange.moveToElementText(el);
		        textRange.collapse(false);
		        textRange.select();
		    }
		}*/


		init();
	</script>

	<title>Notes</title>
</head>
<body>
	<div class="base-div">
		<button onclick="note()">new note</button>
		<button onclick="showNotesList()">all notes</button>
		<button>etc</button>
		<div class="base-div__forms" id="__base-div__forms">
			
		</div>
		

	</div>

</body>
</html>